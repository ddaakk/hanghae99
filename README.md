# 콘서트 예약 시스템

![image](https://github.com/user-attachments/assets/4d4eba33-407f-4838-88f5-f3d878079dc4)


## 개요

이 프로젝트는 콘서트 좌석 예약 시스템으로, 사용자는 원하는 좌석을 선택하고 결제할 수 있습니다. 이 시스템은 대규모 트래픽을 처리할 수 있도록 설계되었으며, Redis 기반의 대기열 처리와 데이터 저장 방식을 통해 효율적으로 좌석을 관리합니다. 성능 최적화와 대규모 트래픽 대응을 목표로 설계되었으며, 주기적인 성능 테스트를 통해 시스템의 안정성을 검증했습니다.

## 구현 단계

### 1. RabbitMQ를 통한 구현

초기에는 RabbitMQ를 사용하여 메시지 큐 방식으로 예약 요청을 처리했습니다. 예약 요청이 발생할 때마다 큐에 메시지를 적재하고, 백엔드에서 해당 메시지를 처리하는 방식으로 비동기 처리를 구현했습니다.

- **장점**: 대규모 트래픽 처리에 유리.
- **단점**: 메시지별 처리 속도가 느리고, 실시간 예약 확인이 어렵다.

### 2. Redis로의 전환

이후 Redis를 활용한 시스템으로 전환했습니다. 대기열 관리와 데이터 캐싱을 통해 성능을 최적화했으며, 예약 요청을 개별적으로 처리하는 대신 주기적으로 일괄 처리하는 방식을 도입했습니다. 이는 예약 처리 속도를 향상시키고 대규모 사용자 요청에 대한 응답성을 개선했습니다. 이 시점부터는 **RabbitMQ를 더 이상 사용하지 않았습니다.**

- **장점**: Redis의 빠른 성능을 활용한 신속한 대기열 처리와 상태 조회 가능.
- **단점**: 주기적으로 처리되므로 실시간 처리에 비해 지연 발생 가능.

### 3. Bulk 처리 도입

최종적으로는 Redis 기반의 주기적 Bulk 처리 방식을 도입하여, 일정 시간마다 예약 요청을 한꺼번에 처리하는 방식으로 성능을 극대화했습니다. 이로 인해 트래픽이 높은 시점에서도 안정적인 예약 처리가 가능해졌습니다.

- **장점**: 대규모 예약 요청을 효율적으로 처리.
- **단점**: 주기적 처리로 인한 실시간성 부족.

#### Bulk 연산 공식

Bulk 처리의 공식은 다음과 같습니다:

```
총 처리 시간 = (단일 요청 처리 시간) * (한 번에 처리하는 요청 수) + (추가 오버헤드)
```

이 공식은 한 번에 많은 요청을 처리하면서도 추가적인 오버헤드(네트워크 지연 등)를 최소화하는 데 중점을 두었습니다.

## 성능 테스트

시스템의 성능을 검증하고 최적화하기 위해 **K6**를 사용하여 성능 테스트를 진행했습니다. 테스트 결과는 **InfluxDB**에 저장되었으며, **Grafana**를 통해 실시간으로 모니터링하면서 성능 병목을 식별하고 개선했습니다. 각 주요 지표(응답 시간, 처리량, 에러율 등)를 기반으로 시스템의 성능을 평가하고, 이를 토대로 최적화 작업을 진행했습니다.

### 성능 개선 예시

성능 테스트를 통해 발견한 병목 중 하나는 다수의 동시 요청을 처리할 때 발생하는 데이터베이스의 연결 문제였습니다. 이를 해결하기 위해 데이터베이스 연결 풀 크기를 조정하고 Redis를 활용한 캐싱 전략을 도입하여 데이터베이스 요청을 줄였습니다.

- **개선 전**: 초당 500개의 요청을 처리할 때 평균 응답 시간이 1.5초로, 높은 응답 시간이 발생하였음.
- **개선 후**: 데이터베이스 최적화와 캐싱 도입 후 초당 500개의 요청을 처리할 때 평균 응답 시간이 0.5초로 단축됨. 트래픽이 증가해도 시스템의 안정성이 크게 향상됨.

이외에도 Redis 기반의 주기적인 Bulk 처리 방식을 최적화하여 대규모 트래픽 상황에서도 시스템의 응답 속도를 유지할 수 있도록 개선하였습니다.

## 사용 기술

- **Spring Boot 3.2.0**: 애플리케이션 프레임워크로 사용되어 RESTful API와 서비스 레이어를 구축했습니다.
- **Kotlin 1.9.20**: Kotlin 언어를 사용하여 코드의 가독성을 높이고, 생산성을 증대시켰습니다.
- **JPA (Spring Data JPA)**: 데이터베이스 접근 계층에서 사용된 ORM 기술로, 객체와 관계형 데이터베이스 간의 매핑을 처리했습니다.
- **Redis**: 예약 상태 및 대기열 관리를 위해 사용한 인메모리 데이터베이스. 빠른 성능을 제공하여 대규모 트래픽 처리에 유리했습니다.
- **Redisson**: Redis 클라이언트로 사용되어 Redis와의 통신을 처리했습니다.
- **H2 Database**: 로컬 환경에서 사용된 인메모리 데이터베이스로, 빠른 테스트 환경 구축에 사용되었습니다.
- **Logback AWSLogs Appender**: AWS CloudWatch에 로그를 적재하여 클라우드 환경에서 로그 모니터링을 가능하게 했습니다.
- **Kotlin Logging**: 로깅 라이브러리로 사용되어 로깅 처리 성능을 최적화했습니다.
- **K6**: 성능 테스트 도구로 시스템의 성능을 평가하고 개선점을 도출하는 데 사용되었습니다.
- **InfluxDB**: 성능 테스트 데이터를 저장하고 관리하는 데 사용되었습니다.
- **Grafana**: 실시간 성능 모니터링 도구로 InfluxDB의 데이터를 시각화하여 성능 개선에 기여했습니다.
